@if (isOpen()) {
<div class="fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4" (click)="onClose()">
  <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md" (click)="$event.stopPropagation()">
    
    <header class="p-4 border-b relative">
      <h2 class="text-2xl font-bold text-center text-gray-800">Hoàn tất đơn hàng</h2>
      <button (click)="onClose()" class="absolute top-1/2 -translate-y-1/2 right-4 text-gray-400 hover:text-gray-700 transition" [disabled]="status() === 'loading'">
        <i class="fa-solid fa-xmark fa-xl"></i>
      </button>
    </header>

    <div class="p-6">
      @switch (status()) {
        @case ('idle') {
          <form (submit)="onConfirm()">
            <label for="customerName" class="block text-sm font-medium text-gray-700 mb-2">Vui lòng nhập tên của bạn:</label>
            <input type="text" 
                   id="customerName" 
                   name="customerName"
                   [ngModel]="customerName()"
                   (ngModelChange)="customerName.set($event)"
                   required
                   autofocus
                   class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-amber-500 focus:border-amber-500"
                   placeholder="Tên của bạn">
            
            <button type="submit"
                    [disabled]="!customerName().trim()"
                    class="w-full bg-green-500 text-white font-bold py-3 rounded-lg mt-6 hover:bg-green-600 transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed">
              Gửi đơn cho Quân
            </button>
          </form>
        }
        @case ('loading') {
          <div class="text-center py-8">
            <i class="fa-solid fa-spinner fa-spin text-4xl text-amber-600"></i>
            <p class="mt-4 text-lg text-gray-700">Đang gửi đơn hàng của bạn...</p>
          </div>
        }
        @case ('success') {
          <div class="text-center py-8">
            <i class="fa-solid fa-circle-check text-5xl text-green-500"></i>
            <p class="mt-4 text-lg text-gray-800 font-semibold">Đặt hàng thành công!</p>
            <p class="text-gray-600 mt-1">Cảm ơn bạn đã đặt hàng.</p>
          </div>
        }
        @case ('error') {
          <div class="text-center py-8">
            <i class="fa-solid fa-circle-xmark text-5xl text-red-500"></i>
            <p class="mt-4 text-lg text-gray-800 font-semibold">Đã có lỗi xảy ra.</p>
            <p class="text-gray-600 mt-1">Chúng tôi không thể đặt hàng. Vui lòng thử lại.</p>
            <button (click)="onConfirm()"
                    [disabled]="!customerName().trim()"
                    class="w-full bg-green-500 text-white font-bold py-3 rounded-lg mt-6 hover:bg-green-600 transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed">
              Thử lại
            </button>
          </div>
        }
      }
    </div>

  </div>
</div>
}